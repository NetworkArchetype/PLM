#!/usr/bin/env python3
"""Post-commit hook: create version tag after commit."""

import subprocess
import sys
from pathlib import Path


def main() -> int:
    repo_root = Path(__file__).resolve().parents[1]
    version_file = repo_root / "VERSION"
    
    if not version_file.exists():
        return 0
    
    version = version_file.read_text().strip()
    if not version:
        return 0
    
    # Check if tag already exists
    result = subprocess.run(
        ["git", "tag", "-l", version],
        cwd=repo_root,
        capture_output=True,
        text=True,
        check=False
    )
    
    if result.stdout.strip():
        # Tag already exists
        return 0
    
    # Create annotated tag
    subprocess.run(
        ["git", "tag", "-a", version, "-m", f"Version {version}"],
        cwd=repo_root,
        check=False
    )
    
    print(f"Created version tag: {version}")
    return 0


if __name__ == "__main__":
    try:
        sys.exit(main())
    except Exception as e:
        print(f"post-commit hook error: {e}", file=sys.stderr)
        sys.exit(0)  # Don't fail the commit
